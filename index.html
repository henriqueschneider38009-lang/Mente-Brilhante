<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caixas Mente Brilhante</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">

<div id="app"></div>

<script>
/* =========================
   DADOS DOS PRODUTOS
   ========================= */
const boxes = [
  { 
    id: 'box-azul', productId: 1234, color: 'Azul', bgColor: 'bg-blue-500',
    price: 71.25, title: 'Inventar', emoji: 'üí°',
    imageOut: 'https://res.cloudinary.com/dveud6a30/image/upload/v1763512765/IMG-20251118-WA0166_rp1nmw.jpg',
    imageIn:  'https://res.cloudinary.com/dveud6a30/image/upload/v1763512762/IMG-20251118-WA0141_pxuykj.jpg'
  },
  { 
    id: 'box-vermelho', productId: 1234, color: 'Vermelho', bgColor: 'bg-red-500',
    price: 71.25, title: 'Pensar', emoji: 'üß†',
    imageOut: 'https://res.cloudinary.com/dveud6a30/image/upload/v1763512493/IMG-20251118-WA0170_rxjrp9.jpg',
    imageIn:  'https://res.cloudinary.com/dveud6a30/image/upload/v1763512493/IMG-20251118-WA0143_su2s8y.jpg'
  },
  { 
    id: 'box-laranja', productId: 1234, color: 'Laranja', bgColor: 'bg-orange-500',
    price: 71.25, title: 'Criar', emoji: '‚ú®',
    imageOut: 'https://res.cloudinary.com/dveud6a30/image/upload/v1763512762/IMG-20251118-WA0176_igxmn3.jpg',
    imageIn:  'https://res.cloudinary.com/dveud6a30/image/upload/v1763512761/IMG-20251118-WA0144_iwfi2z.jpg'
  },
  { 
    id: 'box-verde', productId: 1234, color: 'Verde', bgColor: 'bg-green-500',
    price: 71.25, title: 'Brincar', emoji: 'üéÆ',
    imageOut: 'https://res.cloudinary.com/dveud6a30/image/upload/v1763512761/IMG-20251118-WA0164_rhq5ui.jpg',
    imageIn:  'https://res.cloudinary.com/dveud6a30/image/upload/v1763512760/IMG-20251118-WA0150_p0c78k.jpg'
  }
];

let cart = [];
let currentView = "products"; // 'products' | 'cart' | 'checkout' | 'complete'
let freight = 0;
let orderNumber = "";
let formData = { nome: "", email: "", telefone: "", endereco: "", cidade: "", estado: "", cep: "" };

/* =========================
   RENDER PRINCIPAL
   ========================= */
function render() {
  const app = document.getElementById('app');
  if (currentView === 'products') app.innerHTML = renderProducts();
  if (currentView === 'cart') app.innerHTML = renderCart();
  if (currentView === 'checkout') app.innerHTML = renderCheckout();
  if (currentView === 'complete') app.innerHTML = renderComplete();
}

/* =========================
   PRODUTOS
   ========================= */
function renderProducts() {
  const cartCount = cart.reduce((s, i) => s + i.quantity, 0);
  return `
  <div class="max-w-6xl mx-auto p-6">
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-4xl font-bold text-gray-800">Caixas Mente Brilhante</h1>
        <p class="text-lg text-gray-600">Escolha sua caixa favorita!</p>
      </div>
      <button onclick="showCart()" class="relative bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold">
        Carrinho
        ${cartCount > 0 ? `<span class="absolute -top-2 -right-2 bg-red-500 w-6 h-6 rounded-full text-white flex items-center justify-center text-sm font-bold">${cartCount}</span>` : ""}
      </button>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      ${boxes.map(box => `
        <div class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition">
          <div class="h-56 bg-gray-100 flex items-center justify-center p-2">
            <img src="${box.imageOut}"
                 onmouseover="this.src='${box.imageIn}'"
                 onmouseout="this.src='${box.imageOut}'"
                 alt="${box.title}"
                 class="w-full h-full object-cover"/>
          </div>
          <div class="p-4">
            <h3 class="text-xl font-bold text-gray-800">Caixa para ${box.title}</h3>
            <p class="text-sm text-gray-600 mb-2">Caixa ${box.color}</p>
            <p class="text-2xl font-bold text-gray-900 mb-4">R$ ${box.price.toFixed(2)}</p>
            <button onclick="addToCart('${box.id}')" class="${box.bgColor} text-white w-full py-2.5 rounded-lg font-semibold">
              Adicionar ao Carrinho
            </button>
          </div>
        </div>
      `).join('')}
    </div>

    <!-- KIT COMPLETO -->
    <div class="max-w-4xl mx-auto bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl shadow-2xl p-6 text-white mt-10">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
        <div>
          <h3 class="text-2xl sm:text-3xl font-bold mb-1">üéÅ Kit Completo</h3>
          <p class="opacity-90">Leve todas as 4 caixas juntas!</p>
        </div>
        <div class="text-left sm:text-right">
          <p class="text-3xl sm:text-4xl font-bold">R$ 285,00</p>
        </div>
      </div>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-6">
        ${boxes.map(b => `<div class="aspect-square rounded-lg overflow-hidden bg-white"><img src="${b.imageOut}" alt="${b.title}" class="w-full h-full object-cover"></div>`).join('')}
      </div>

      <button onclick="addComboToCart()" class="w-full bg-white text-purple-700 py-3 rounded-lg font-bold">
        Adicionar Kit ao Carrinho
      </button>
    </div>
  </div>
  `;
}

/* =========================
   CARRINHO
   ========================= */
function renderCart() {
  const subtotal = cart.reduce((s,i)=> s + i.price * i.quantity, 0);
  return `
  <div class="max-w-4xl mx-auto p-6">
    <button onclick="setView('products')" class="text-purple-600 font-semibold mb-6">‚Üê Continuar comprando</button>

    <div class="bg-white p-6 rounded-2xl shadow-2xl">
      <h2 class="text-3xl font-bold mb-6">üõí Carrinho</h2>

      ${cart.length === 0 ? `
        <div class="text-center py-10">
          <p class="text-xl text-gray-500 mb-4">Seu carrinho est√° vazio</p>
          <button onclick="setView('products')" class="bg-purple-600 text-white py-3 px-6 rounded-lg">Ver produtos</button>
        </div>
      ` : `
        <div class="space-y-4">
          ${cart.map((item, index) => `
            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
              <div class="${item.bgColor} text-white w-16 h-16 rounded-lg flex items-center justify-center text-3xl">${item.emoji}</div>
              <div class="flex-1">
                <h3 class="font-bold">${item.title}</h3>
                <p class="text-gray-500 text-sm">${item.color} ‚Äî R$ ${item.price.toFixed(2)}</p>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="updateQuantity(${index}, -1)" class="w-8 h-8 bg-gray-200 rounded-full">-</button>
                <span class="w-8 text-center font-bold">${item.quantity}</span>
                <button onclick="updateQuantity(${index}, 1)" class="w-8 h-8 bg-gray-200 rounded-full">+</button>
              </div>
              <p class="font-bold w-20 text-right">R$ ${(item.price * item.quantity).toFixed(2)}</p>
              <button onclick="removeFromCart(${index})" class="text-red-500 text-xl">üóë</button>
            </div>
          `).join('')}
        </div>

        <div class="border-t pt-6 mt-6">
          <div class="flex justify-between mb-6">
            <span class="text-xl font-bold">Subtotal:</span>
            <span class="text-2xl font-bold text-purple-600">R$ ${subtotal.toFixed(2)}</span>
          </div>

          <button onclick="setView('checkout')" class="bg-purple-600 w-full text-white py-4 rounded-lg font-bold text-lg">Ir para o checkout</button>
        </div>
      `}
    </div>
  </div>
  `;
}

/* =========================
   CHECKOUT (corrigido: inputs mant√™m valor)
   ========================= */
function renderCheckout() {
  const subtotal = cart.reduce((s,i)=> s + i.price * i.quantity, 0);
  const total = subtotal + freight;

  // Note: usamos value="${...}" para preservar o texto digitado mesmo ap√≥s render()
  return `
  <div class="max-w-2xl mx-auto p-6">
    <button onclick="setView('cart')" class="text-purple-600 font-semibold mb-6">‚Üê Voltar ao carrinho</button>

    <div class="bg-white p-6 rounded-2xl shadow-2xl">
      <h2 class="text-3xl font-bold mb-6">Finalizar Compra</h2>

      <form onsubmit="handleCheckout(event)" class="space-y-4">
        <input required type="text" placeholder="Nome completo" class="w-full border p-3 rounded-lg"
               value="${escapeHtml(formData.nome)}"
               oninput="formData.nome=this.value">
        <input required type="email" placeholder="Email" class="w-full border p-3 rounded-lg"
               value="${escapeHtml(formData.email)}"
               oninput="formData.email=this.value">
        <input required type="tel" placeholder="Telefone" class="w-full border p-3 rounded-lg"
               value="${escapeHtml(formData.telefone)}"
               oninput="formData.telefone=this.value">
        <input required type="text" placeholder="Endere√ßo" class="w-full border p-3 rounded-lg"
               value="${escapeHtml(formData.endereco)}"
               oninput="formData.endereco=this.value">

        <div class="grid grid-cols-2 gap-4">
          <input required type="text" placeholder="Cidade" class="border p-3 rounded-lg"
                 value="${escapeHtml(formData.cidade)}"
                 oninput="formData.cidade=this.value">
          <input required type="text" placeholder="UF" maxlength="2" class="border p-3 rounded-lg"
                 value="${escapeHtml(formData.estado)}"
                 oninput="formData.estado=this.value.toUpperCase(); calculateFreight()">
        </div>

        <input required type="text" placeholder="CEP" class="w-full border p-3 rounded-lg"
               value="${escapeHtml(formData.cep)}"
               oninput="formData.cep=this.value">

        ${formData.estado ? `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
            <h3 class="font-semibold mb-2">Resumo do Pedido</h3>
            <div class="flex justify-between"><span>Produtos:</span><span class="font-bold">R$ ${subtotal.toFixed(2)}</span></div>
            <div class="flex justify-between"><span>Frete:</span><span class="font-bold">${freight === 0 ? 'Gr√°tis' : `R$ ${freight.toFixed(2)}`}</span></div>
            <div class="flex justify-between border-t pt-2 mt-2 font-bold"><span>Total:</span><span class="text-purple-600">R$ ${total.toFixed(2)}</span></div>
          </div>
        ` : ''}

        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold mt-4">Finalizar compra</button>
      </form>
    </div>
  </div>
  `;
}

/* =========================
   TELA AGUARDANDO PAGAMENTO (OP√á√ÉO C)
   ========================= */
function renderComplete() {
  const subtotal = cart.reduce((s,i)=> s + i.price * i.quantity, 0);
  const total = subtotal + freight;

  return `
  <div class="min-h-screen p-8 flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md text-center">
      <div class="w-20 h-20 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      </div>

      <h2 class="text-3xl font-bold mb-2">Aguardando Pagamento</h2>

      <div class="bg-purple-100 border border-purple-300 rounded-lg p-4 mb-4">
        <p class="text-sm text-purple-700 font-semibold mb-1">N√∫mero do Pedido</p>
        <p class="text-3xl font-bold text-purple-800">#${orderNumber}</p>
      </div>

      <p class="text-gray-600 mb-6">Obrigado, ${escapeHtml(formData.nome)}! Seu pedido foi registrado com sucesso.</p>

      <div class="bg-gray-50 rounded-lg p-4 mb-6 text-sm">
        ${cart.map(i => `
          <div class="flex justify-between mb-2">
            <span>${i.quantity}x Caixa ${i.title}</span>
            <span class="font-semibold">R$ ${(i.price * i.quantity).toFixed(2)}</span>
          </div>
        `).join('')}

        <div class="border-t pt-2 mt-2">
          <div class="flex justify-between"><span>Subtotal:</span><span>R$ ${subtotal.toFixed(2)}</span></div>
          <div class="flex justify-between"><span>Frete:</span><span>${freight === 0 ? 'Gr√°tis' : `R$ ${freight.toFixed(2)}`}</span></div>
          <div class="flex justify-between font-bold text-lg mt-2"><span>Total:</span><span>R$ ${total.toFixed(2)}</span></div>
        </div>
      </div>

      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 text-sm text-yellow-800">
        ‚è≥ Realize o pagamento para confirmar seu pedido. Voc√™ receber√° as instru√ß√µes no email cadastrado.
      </div>

      <button onclick="resetOrder()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold">Fazer novo pedido</button>
    </div>
  </div>
  `;
}

/* =========================
   FUN√á√ïES DE L√ìGICA
   ========================= */
function setView(v) { currentView = v; render(); }
function showCart() { setView('cart'); }

function addToCart(boxId) {
  const box = boxes.find(b => b.id === boxId);
  const found = cart.find(i => i.id === boxId);
  if (found) found.quantity++;
  else cart.push({ ...box, quantity: 1 });
  render();
}

function addComboToCart() {
  const existing = cart.find(i => i.id === 'combo');
  if (existing) existing.quantity++;
  else cart.push({
    id: 'combo', productId: 45678, title: 'Kit Completo', emoji: 'üéÅ',
    bgColor: 'bg-purple-600', price: 285.00, quantity: 1, isCombo: true
  });
  render();
}

function updateQuantity(index, delta) {
  cart[index].quantity += delta;
  if (cart[index].quantity <= 0) cart.splice(index,1);
  render();
}

function removeFromCart(index) {
  cart.splice(index,1);
  render();
}

function calculateFreight() {
  freight = formData.estado && formData.estado !== 'ES' ? 15 : 0;
  render();
}

/* Finalizar compra ‚Äî substitui o checkout pela tela "Aguardando Pagamento" (Op√ß√£o C) */
function handleCheckout(e) {
  e.preventDefault();
  orderNumber = freight > 0 ? '5678' : Math.floor(10000 + Math.random() * 90000).toString();
  currentView = 'complete';
  render();
}

/* Resetar tudo e voltar para produtos */
function resetOrder() {
  cart = [];
  freight = 0;
  orderNumber = '';
  formData = { nome: "", email: "", telefone: "", endereco: "", cidade: "", estado: "", cep: "" };
  currentView = 'products';
  render();
}

/* Pequena fun√ß√£o de escape para evitar quebra quando inserir aspas/acento */
function escapeHtml(str) {
  if (!str && str !== "") return "";
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

/* Inicializa */
render();
</script>

</body>
</html>
